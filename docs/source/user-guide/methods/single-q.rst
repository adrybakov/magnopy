.. _user-guide_methods_single-q:

**********************
Single-q conical state
**********************

.. dropdown:: Notation used on this page

  For the full set of notation rules, see :ref:`user-guide_methods_notation`.

  * .. include:: page-notations/vector.inc
  * .. include:: page-notations/matrix.inc
  * .. include:: page-notations/bra-ket.inc
  * .. include:: page-notations/parentheses.inc
  * .. include:: page-notations/uvn-or-spherical.inc
  * .. include:: page-notations/rotations.inc

Description of the atomic lattice
=================================
We define a Bravais lattice with primitve vectors
:math:`\{\boldsymbol{a_1}, \boldsymbol{a_2}, \boldsymbol{a_3}\}`.
The Bravais lattice is composed of :math:`M=M_1 \times M_2 \times M_3`
unit cells whose positions are given by

.. math::
  \boldsymbol{r}_m
  =
  m_1\, \boldsymbol{a_1} + m_2\, \boldsymbol{a_2} + m_3\, \boldsymbol{a_3}

Each cell contains :math:`I` atoms with intra-cell positions
:math:`\boldsymbol{r}_i` and overall positions

.. math::
  \boldsymbol{r}_{mi} = \boldsymbol{r}_m + \boldsymbol{r}_i

Description of the conical state
================================
The conical state is defined by the cone axis, that is directed along the unit
vector :math:`\boldsymbol{n}`, and by the spiral wave-vector
:math:`\boldsymbol{q}`. Magnopy constructs the single-q conical state in three stages.

1.  It starts by populating all the atomic sites with spin vectors collinear to
    :math:`\boldsymbol{\hat{n}}`

    .. math::
      \boldsymbol{S^F}_{i} = S_i\, \boldsymbol{\hat{n}}

2.  These vectors are subsequently rotated by rotation matrices
    :math:`\boldsymbol{R}_i = \boldsymbol{R}(\theta_i, \phi_i(\boldsymbol{q}))`,
    that were introduced :ref:`previously <user-guide_methods_spin-rotations>`,
    The rotation azimuth angles are
    :math:`\phi_i(\boldsymbol{q}) = \boldsymbol{q}\cdot\boldsymbol{r_i} + \Delta\phi_i`:

    .. include:: repeated-formulas/spin-from-ferro-any.inc

    The above rotations populate each unit cell in the lattice by a collection of
    non-collinear atomic spins :math:`\boldsymbol{S}_i`. Since these rotations do not
    depend on the cell index :math:`m`, all unit cells spin arrangements are replica
    of each other at this stage.

3.  Finally, the cone spin arrangement among  unit cells is generated by the rotation
    :math:`\boldsymbol{R}_m = \boldsymbol{R_n}(\phi_m(\boldsymbol{q}))`, where the
    azimuth angle is :math:`\phi_m(\boldsymbol{q}) = \boldsymbol{q}\cdot\boldsymbol{r_m}`.

    .. math::
      \boldsymbol{S}_{mi} = \boldsymbol{R}_m\, \boldsymbol{S}_i

    The explicit expression for the matrix in the :math:`(u\, v\, n)` reference frame is

    .. include:: repeated-formulas/spiral-rotation-matrix-uvn.inc

The coordinates of the spin vector in the :math:`(u\, v\, n)` reference frame are

.. include:: repeated-formulas/spin-from-ferro-uvn.inc

where the full azimuth angles are

.. include:: repeated-formulas/full-azimuth-angle.inc

.. note::
  Magnopy absorbs the intra-cell spiral contribution inside the azimuth angle
  :math:`\phi_i(\boldsymbol{q}) = \boldsymbol{q}\cdot\boldsymbol{r_i} + \Delta\, \phi_i`.

  In the following we always use the notation :math:`\phi_i` for total intra-cell azimuth
  angle, :math:`\phi_{mi}` for the total azimuth angle and :math:`\phi_{m}` for the
  inter-cell part of the azimuth angle with the understanding that all three angles
  depends on the spiral vector :math:`\boldsymbol{q}`. The q-independent part of the
  azimuth angle :math:`\Delta\, \phi_i` will be used explicitly if needed.


  In the :ref:`Magnopy input file <user-guide_input_model-file>` in the
  :ref:`"Atoms" section <user-guide_input_model-file_atoms>` the direction of the atom's
  spin correspond **only** to the :math:`\Delta\, \phi_i` part of the total azimuth angle
  :math:`\phi_i`. The spiral-dependent part :math:`\boldsymbol{q}\cdot\boldsymbol{r_i}`
  of the azimuth angle :math:`\phi_i` is computed by Magnopy based on the provided
  :ref:`Cone axis <user-guide_input_model-file_cone-axis>` and
  :ref:`Spiral vector <user-guide_input_model-file_spiral-vector>`.

.. dropdown:: Full expression of the rotation matrix  :math:`\text{ }\boldsymbol{R}_{mi}`

  We define the different matrix elements as follows

  .. math::
    \boldsymbol{R}_{mi}
    =
    \begin{pmatrix}
      R^{11} & R^{12} & R^{13} \\
      R^{21} & R^{22} & R^{23} \\
      R^{31} & R^{32} & R^{33} \\
    \end{pmatrix}

  Then those matrix elements are

  .. math::
    &R^{11}
    =
    \cos(\boldsymbol{q} \cdot \boldsymbol{r_m})
    \left[ \cos\theta_i + \sin^2\phi_i\, \, (1-\cos\theta_i) \right]
    -
    \sin(\boldsymbol{q} \cdot \boldsymbol{r_m})
    \left[ -\sin\phi_i\, \cos\phi_i\, \, (1-\cos\theta_i) \right]
    =\\&=
    (1 - \cos\theta_i)
    \left[
      \cos(\boldsymbol{q} \cdot \boldsymbol{r_m})\, \sin^2\phi_i
      +
      \sin(\boldsymbol{q} \cdot \boldsymbol{r_m})\, \sin\phi_i\, \cos\phi_i
    \right]
    +
    \cos(\boldsymbol{q} \cdot \boldsymbol{r_m})\, \cos\theta_i
    =\\&=
    (1 - \cos\theta_i)\, \sin\phi_i\, \sin(\boldsymbol{q} \cdot \boldsymbol{r_m} + \phi_i)
    +
    \cos(\boldsymbol{q} \cdot \boldsymbol{r_m})\, \cos\theta_i

  .. math::
    &R^{12}
    =
    \cos(\boldsymbol{q} \cdot \boldsymbol{r_m})
    \left[ -\sin\phi_i\, \cos\phi_i\, \, (1 - \cos\theta_i) \right]
    -
    \sin(\boldsymbol{q} \cdot \boldsymbol{r_m})
    \left[ \cos\theta_i + \cos^2\phi_i\, \, (1 -\ cos\theta_i) \right]
    =\\&=
    (1 - \cos\theta_i)
    \left[
      -\cos(\boldsymbol{q} \cdot \boldsymbol{r_m})\, \sin\phi_i\, \cos\phi_i
      -
      \sin(\boldsymbol{q} \cdot \boldsymbol{r_m})\, \cos^2\phi_i
    \right]
    -
    \sin(\boldsymbol{q} \cdot \boldsymbol{r_m})\, \cos\theta_i
    =\\&=
    -(1 - \cos\theta_i)\, \cos\phi_i\, \sin(\boldsymbol{q} \cdot \boldsymbol{r_m} + \phi_i)
    -
    \sin(\boldsymbol{q} \cdot \boldsymbol{r_m})\, \cos\theta_i

  .. math::
    R^{13}
    =
    \sin\theta_i\,\,
    (
      \cos(\boldsymbol{q} \cdot \boldsymbol{r_m})\, \cos\phi_i
      -
      \sin(\boldsymbol{q} \cdot \boldsymbol{r_m})\, \sin\phi_i
    )
    =
    \sin\theta_i\,\cos(\boldsymbol{q} \cdot \boldsymbol{r_m} + \phi_i)

  .. math::
    &R^{21}
    =
    \sin(\boldsymbol{q} \cdot \boldsymbol{r_m})
    \left[ \cos\theta_i + \sin^2\phi_i\, \, (1 - \cos\theta_i) \right]
    +
    \cos(\boldsymbol{q} \cdot \boldsymbol{r_m})
    \left[ -\sin\phi_i\, \cos\phi_i\, \, (1 - \cos\theta_i) \right]
    =\\&=
    (1 - \cos\theta_i)
    \left[
      \sin(\boldsymbol{q} \cdot \boldsymbol{r_m})\, \sin^2\phi_i
      -
      \cos(\boldsymbol{q} \cdot \boldsymbol{r_m})\, \sin\phi_i\, \cos\phi_i
    \right]
    +
    \sin(\boldsymbol{q} \cdot \boldsymbol{r_m})\, \cos\theta_i
    =\\&=
    -(1 - \cos\theta_i)\, \sin\phi_i\, \cos(\boldsymbol{q} \cdot \boldsymbol{r_m} + \phi_i)
    +
    \sin(\boldsymbol{q} \cdot \boldsymbol{r_m})\, \cos\theta_i

  .. math::
    &R^{22}
    =
    \sin(\boldsymbol{q} \cdot \boldsymbol{r_m})
    \left[ -\sin\phi_i\, \cos\phi_i\, \, (1 - \cos\theta_i) \right]
    +
    \cos(\boldsymbol{q} \cdot \boldsymbol{r_m})
    \left[ \cos\theta_i + \cos^2\phi_i\, \, (1 - \cos\theta_i) \right]
    =\\&=
    (1 - \cos\theta_i)
    \left[
      -\sin(\boldsymbol{q} \cdot \boldsymbol{r_m})\, \sin\phi_i\, \cos\phi_i
      +
      \cos(\boldsymbol{q} \cdot \boldsymbol{r_m})\, \cos^2\phi_i
    \right]
    +
    \cos(\boldsymbol{q} \cdot \boldsymbol{r_m})\, \cos\theta_i
    =\\&=
    (1 - \cos\theta_i)\, \cos\phi_i\, \cos(\boldsymbol{q} \cdot \boldsymbol{r_m} + \phi_i)
    +
    \cos(\boldsymbol{q} \cdot \boldsymbol{r_m})\, \cos\theta_i

  .. math::
    R^{23}
    =
    \sin\theta_i\, \, (\sin(\boldsymbol{q} \cdot \boldsymbol{r_m})\, \cos\phi_i
    +
    \cos(\boldsymbol{q} \cdot \boldsymbol{r_m})\, \sin\phi_i)
    =
    \sin\theta_i\, \sin(\boldsymbol{q} \cdot \boldsymbol{r_m} + \phi_i)

  .. math::
    R^{31} = -\cos\phi_i\, \sin\theta_i

  .. math::
    R^{32} = -\sin\phi_i\, \sin\theta_i

  .. math::
    R^{33} = \cos\theta_i

.. _user-guide_methods_single-q_examples:

Examples
========

* One spin in the unit cell, :math:`\boldsymbol{q} = (0,0,1)^T`:

  - :math:`\boldsymbol{r}_1 = (0,0,0)`,
    :math:`\theta_1 = 90^{\circ}`,
    :math:`\phi_1 = 0^{\circ}`


.. raw:: html
  :file: ../../../images/single-q-1.html

.. rst-class:: plotly-figure-caption

  **Figure 1** (interactive)

* One spin in the unit cell, :math:`\boldsymbol{q} = (0,0,1)^T`:

  - :math:`\boldsymbol{r}_1 = (0,0,0)`,
    :math:`\theta_1 = 60^{\circ}`,
    :math:`\phi_1 = 0^{\circ}`


.. raw:: html
  :file: ../../../images/single-q-2.html

.. rst-class:: plotly-figure-caption

  **Figure 2** (interactive)

* One spin in the unit cell, :math:`\boldsymbol{q} = (0,0,1)^T`:

  - :math:`\boldsymbol{r}_1 = (0,0,0)`,
    :math:`\theta_1 = 60^{\circ}`,
    :math:`\phi_1 = 45^{\circ}`

.. raw:: html
  :file: ../../../images/single-q-3.html

.. rst-class:: plotly-figure-caption

  **Figure 3** (interactive)

* One spin in the unit cell, :math:`\boldsymbol{q} = (0,1,0)^T`:

  - :math:`\boldsymbol{r}_1 = (0,0,0)`,
    :math:`\theta_1 = 30^{\circ}`,
    :math:`\phi_1 = 0^{\circ}`

.. raw:: html
  :file: ../../../images/single-q-4.html

.. rst-class:: plotly-figure-caption

  **Figure 4** (interactive)

* Two spins in the unit cell, :math:`\boldsymbol{q} = (0,1,0)^T`:

  - :math:`\boldsymbol{r}_1 = (0,0,0)`,
    :math:`\theta_1 = 30^{\circ}`,
    :math:`\phi_1 = 0^{\circ}`
  - :math:`\boldsymbol{r}_2 = (\frac{1}{2},\frac{1}{2},\frac{1}{2})`,
    :math:`\theta_2 = 20^{\circ}`,
    :math:`\phi_2 = 45^{\circ}`


.. raw:: html
  :file: ../../../images/single-q-5.html

.. rst-class:: plotly-figure-caption

  **Figure 5** (interactive)

* Two spins in the unit cell, :math:`\boldsymbol{q} = (1,0,0)^T`:

  - :math:`\boldsymbol{r}_1 = (0,0,0)`,
    :math:`\theta_1 = 150^{\circ}`,
    :math:`\phi_1 = 0^{\circ}`
  - :math:`\boldsymbol{r}_2 = (0,\frac{1}{2},0)`,
    :math:`\theta_2 = 30^{\circ}`,
    :math:`\phi_2 =180^{\circ}`

.. raw:: html
  :file: ../../../images/single-q-6.html

.. rst-class:: plotly-figure-caption

  **Figure 6** (interactive)
