.. _user-guide_methods_single-q:

**********************
Single-q conical state
**********************

.. dropdown:: Notation used on this page

  * .. include:: page-notations/vector.inc
  * .. include:: page-notations/matrix.inc
  * .. include:: page-notations/bra-ket.inc
  * .. include:: page-notations/parentheses.inc
  * .. include:: page-notations/uvn-or-spherical.inc

Description of the atomic lattice
=================================
We define a Bravais lattice with primitve vectors
:math:`\{\boldsymbol{a_1},\boldsymbol{a_2},\boldsymbol{a_3}\}`.
The Bravais lattice is composed of :math:`M=M_1\times M_2\times M_3`
unit cells whose positions are given by

.. math::
  \boldsymbol{r_m} = m_1\,\boldsymbol{a_1} + m_2\,\boldsymbol{a_2} + m_3\,\boldsymbol{a_3}

Each cell contains :math:`I` atoms with intra-cell positions
:math:`\boldsymbol{r_i}` and overall positions

.. math::
  \boldsymbol{r_{mi}} = \boldsymbol{r_m} + \boldsymbol{r_i}

Description of the conical state
================================
The conical state is defined by the cone axis, that is directed along the unit
vector :math:`\boldsymbol{n}`, and by the spiral vector
:math:`\boldsymbol{q}`. Magnopy constructs the single-q conical state in three stages.

It starts by populating all the atomic sites with spin vectors collinear to
:math:`\boldsymbol{n}`

.. math::
  \boldsymbol{S^F}_{i}=S_i\,\boldsymbol{\hat{n}}

These vectors are subsequently rotated with rotation matrices :math:`\boldsymbol{R}_i`
introduced in the :ref:`previous section <user-guide_methods_spin-rotations>`,
which does not depend on the position of the unit cell in the lattice:

.. math::
  \boldsymbol{S}_{i}=
  \boldsymbol{R}_i\,\boldsymbol{S^F}_{i}=S_i\,\boldsymbol{R}_i\,\boldsymbol{\hat{n}}
  =S_i\,\boldsymbol{\hat{f}}_i

The above rotations populate each unit cell by a collection of non-collinear atomic spins
:math:`\boldsymbol{S}_i`.
Because thse rotations do not depend on :math:`m`, all unit cells
spin arrangements are replica of each other at this stage.

Finally, the cone spin arrangement among  unit cells is generated by the rotation

.. math::
  \boldsymbol{R}_m=\boldsymbol{R_n}(\phi_m)=e^{\boldsymbol{\hat{n}}\,\phi_m\,\times}

where the azimut angle is

.. math::
  \phi_m = \boldsymbol{q}\cdot\boldsymbol{r_m}

The explicit expression for the matrix in the :math:`(\,u\,v\,n\,)` reference frame is

.. include:: repeated-formulas/spiral-rotation-matrix-uvn.inc

The spin vector coordinates in the :math:`(\,u\,v\,n\,)` reference frame are

.. math::
  \boldsymbol{S}_{mi}= \boldsymbol{R}_m\,\boldsymbol{S}_{i}=
  \boldsymbol{R}_m\,\boldsymbol{R}_i\,\boldsymbol{S^F}_{i}
  =S_i\,\boldsymbol{R}_m\,\boldsymbol{\hat{f}}_i
  =&\,S_i\,
     \begin{pmatrix}
            \sin\theta_i\,\cos\phi_{mi} \\
            \sin\theta_i\,\sin\phi_{mi} \\
            \cos\theta_i
     \end{pmatrix}

where the full azimut angles are

.. math::
  \phi_{mi}(q) = \phi_m(\boldsymbol{q}) + \phi_i(\boldsymbol{q})
               = \boldsymbol{q}\cdot\boldsymbol{r_m} +
                  \boldsymbol{q}\cdot\boldsymbol{r_i}+ \Delta\phi_i
               = \boldsymbol{q}\cdot\boldsymbol{r_{mi}} + \Delta\phi_i

Note that Magnopy absorves the intra-cell spiral contribution inside the azimut
angle :math:`\phi_i=\boldsymbol{q}\cdot\boldsymbol{r_i}+\Delta\,\phi_i`.
The intra-cell spiral angle :math:`\Delta\,\phi_i` must be provided in Magnopy's
input file, but will no longer be used here.

.. dropdown:: Full expression of the rotation matrix  :math:`\text{ }\boldsymbol{R}_{mi}`

  We define the different matrix elements as follows

  .. math::
    \boldsymbol{R}_{mi}
    =
    \begin{pmatrix}
      R^{11} & R^{12} & R^{13} \\
      R^{21} & R^{22} & R^{23} \\
      R^{31} & R^{32} & R^{33} \\
    \end{pmatrix}

  Then those matrix elements are

  .. math::
    &R^{11}
    =
    \cos(\boldsymbol{q}\cdot\boldsymbol{r_m})\left[\cos\theta_i + \sin^2\phi_i(1-\cos\theta_i)\right]-\sin(\boldsymbol{q}\cdot\boldsymbol{r_m})\left[-\sin\phi_i\cos\phi_i(1-\cos\theta_i)\right]
    =\\&=
    (1-\cos\theta_i)\left[\cos(\boldsymbol{q}\cdot\boldsymbol{r_m})\sin^2\phi_i+\sin(\boldsymbol{q}\cdot\boldsymbol{r_m})\sin\phi_i\cos\phi_i\right]+\cos(\boldsymbol{q}\cdot\boldsymbol{r_m})\cos\theta_i
    =\\&=
    (1-\cos\theta_i)\sin\phi_i\sin(\boldsymbol{q}\cdot\boldsymbol{r_m}+\phi_i)+\cos(\boldsymbol{q}\cdot\boldsymbol{r_m})\cos\theta_i

  .. math::
    &R^{12}
    =
    \cos(\boldsymbol{q}\cdot\boldsymbol{r_m})\left[-\sin\phi_i\cos\phi_i(1-\cos\theta_i)\right]-\sin(\boldsymbol{q}\cdot\boldsymbol{r_m})\left[\cos\theta_i + \cos^2\phi_i(1-\cos\theta_i)\right]
    =\\&=
    (1-\cos\theta_i)\left[-\cos(\boldsymbol{q}\cdot\boldsymbol{r_m})\sin\phi_i\cos\phi_i-\sin(\boldsymbol{q}\cdot\boldsymbol{r_m})\cos^2\phi_i\right]-\sin(\boldsymbol{q}\cdot\boldsymbol{r_m})\cos\theta_i
    =\\&=
    -(1-\cos\theta_i)\cos\phi_i\sin(\boldsymbol{q}\cdot\boldsymbol{r_m}+\phi_i)-\sin(\boldsymbol{q}\cdot\boldsymbol{r_m})\cos\theta_i

  .. math::
    R^{13}
    =
    \sin\theta_i(\cos(\boldsymbol{q}\cdot\boldsymbol{r_m})\cos\phi_i - \sin(\boldsymbol{q}\cdot\boldsymbol{r_m})\sin\phi_i)
    =
    \sin\theta_i\cos(\boldsymbol{q}\cdot\boldsymbol{r_m} + \phi_i)

  .. math::
    &R^{21}
    =
    \sin(\boldsymbol{q}\cdot\boldsymbol{r_m})\left[\cos\theta_i + \sin^2\phi_i(1-\cos\theta_i)\right]+\cos(\boldsymbol{q}\cdot\boldsymbol{r_m})\left[-\sin\phi_i\cos\phi_i(1-\cos\theta_i)\right]
    =\\&=
    (1-\cos\theta_i)\left[\sin(\boldsymbol{q}\cdot\boldsymbol{r_m})\sin^2\phi_i-\cos(\boldsymbol{q}\cdot\boldsymbol{r_m})\sin\phi_i\cos\phi_i\right]+\sin(\boldsymbol{q}\cdot\boldsymbol{r_m})\cos\theta_i
    =\\&=
    -(1-\cos\theta_i)\sin\phi_i\cos(\boldsymbol{q}\cdot\boldsymbol{r_m}+\phi_i)+\sin(\boldsymbol{q}\cdot\boldsymbol{r_m})\cos\theta_i

  .. math::
    &R^{22}
    =
    \sin(\boldsymbol{q}\cdot\boldsymbol{r_m})\left[-\sin\phi_i\cos\phi_i(1-\cos\theta_i)\right]+\cos(\boldsymbol{q}\cdot\boldsymbol{r_m})\left[\cos\theta_i + \cos^2\phi_i(1-\cos\theta_i)\right]
    =\\&=
    (1-\cos\theta_i)\left[-\sin(\boldsymbol{q}\cdot\boldsymbol{r_m})\sin\phi_i\cos\phi_i+\cos(\boldsymbol{q}\cdot\boldsymbol{r_m})\cos^2\phi_i\right]+\cos(\boldsymbol{q}\cdot\boldsymbol{r_m})\cos\theta_i
    =\\&=
    (1-\cos\theta_i)\cos\phi_i\cos(\boldsymbol{q}\cdot\boldsymbol{r_m}+\phi_i)+\cos(\boldsymbol{q}\cdot\boldsymbol{r_m})\cos\theta_i

  .. math::
    R^{23}
    =
    \sin\theta_i(\sin(\boldsymbol{q}\cdot\boldsymbol{r_m})\cos\phi_i + \cos(\boldsymbol{q}\cdot\boldsymbol{r_m})\sin\phi_i)
    =
    \sin\theta_i\sin(\boldsymbol{q}\cdot\boldsymbol{r_m} + \phi_i)

  .. math::
    R^{31} = -\cos\phi_i\sin\theta_i

  .. math::
    R^{32} = -\sin\phi_i\sin\theta_i

  .. math::
    R^{33} = \cos\theta_i

.. _user-guide_methods_single-q_examples:

Examples
========

* One spin in the unit cell, :math:`\boldsymbol{q} = (0,0,1)^T`:

  - :math:`\boldsymbol{r}_1 = (0,0,0)`,
    :math:`\theta_1 = 90^{\circ}`,
    :math:`\phi_1 = 0^{\circ}`


.. raw:: html
  :file: ../../../images/single-q-1.html

* One spin in the unit cell, :math:`\boldsymbol{q} = (0,0,1)^T`:

  - :math:`\boldsymbol{r}_1 = (0,0,0)`,
    :math:`\theta_1 = 60^{\circ}`,
    :math:`\phi_1 = 0^{\circ}`


.. raw:: html
  :file: ../../../images/single-q-2.html

* One spin in the unit cell, :math:`\boldsymbol{q} = (0,0,1)^T`:

  - :math:`\boldsymbol{r}_1 = (0,0,0)`,
    :math:`\theta_1 = 60^{\circ}`,
    :math:`\phi_1 = 45^{\circ}`

.. raw:: html
  :file: ../../../images/single-q-3.html

* One spin in the unit cell, :math:`\boldsymbol{q} = (0,1,0)^T`:

  - :math:`\boldsymbol{r}_1 = (0,0,0)`,
    :math:`\theta_1 = 30^{\circ}`,
    :math:`\phi_1 = 0^{\circ}`

.. raw:: html
  :file: ../../../images/single-q-4.html

* Two spins in the unit cell, :math:`\boldsymbol{q} = (0,1,0)^T`:

  - :math:`\boldsymbol{r}_1 = (0,0,0)`,
    :math:`\theta_1 = 30^{\circ}`,
    :math:`\phi_1 = 0^{\circ}`
  - :math:`\boldsymbol{r}_2 = (\frac{1}{2},\frac{1}{2},\frac{1}{2})`,
    :math:`\theta_2 = 20^{\circ}`,
    :math:`\phi_2 = 45^{\circ}`


.. raw:: html
  :file: ../../../images/single-q-5.html

* Two spins in the unit cell, :math:`\boldsymbol{q} = (1,0,0)^T`:

  - :math:`\boldsymbol{r}_1 = (0,0,0)`,
    :math:`\theta_1 = 150^{\circ}`,
    :math:`\phi_1 = 0^{\circ}`
  - :math:`\boldsymbol{r}_2 = (0,\frac{1}{2},0)`,
    :math:`\theta_2 = 30^{\circ}`,
    :math:`\phi_2 =180^{\circ}`

.. raw:: html
  :file: ../../../images/single-q-6.html
