.. _user-guide_methods_single-q:

**********************
Single-q conical state
**********************

.. dropdown:: Notation used on this page

  * .. include:: page-notations/vector.txt
  * .. include:: page-notations/matrix.txt
  * .. include:: page-notations/bra-ket.txt
  * .. include:: page-notations/in-uvn.txt
  * .. include:: page-notations/parentheses.txt

Description of the atomic spin lattice
======================================
We define a Bravais lattice with primitve vectors
:math:`\{\boldsymbol{a_1},\boldsymbol{a_2},\boldsymbol{a_3}\}`.
The Bravais lattice is composed of :math:`M=M_1\times M_2\times M_3`
unit cells whose positions are given by

.. math::
  \boldsymbol{r_m} = m_1\,\boldsymbol{a_1} + m_2\,\boldsymbol{a_2} + m_3\,\boldsymbol{a_3}

Each cell contains :math:`I` atoms with intra-cell positions
:math:`\boldsymbol{r_i}` and overall positions

.. math::
  \boldsymbol{r_{mi}} = \boldsymbol{r_m} + \boldsymbol{r_i}

Cone direction, pitch vector and rotation matrix
================================================
A single-:math:`\boldsymbol{q}` conical spin state can be described by two vectors

* The unit vector :math:`\boldsymbol{\hat{n}}` that defines the cone axis direction.
  Magnopy uses the :math:`(\,u\,v\,n\,)` reference frame where :math:`n` refers to
  the cone vector, as described in the section :ref:`user-guide_methods_uvn-choice`.
* A pitch vector :math:`\boldsymbol{q}` that defines the spiral propagation through
  the azimut phase :math:`\phi_m = \boldsymbol{q}\cdot\boldsymbol{r_m}`.

Both vectors define the cone-state rotation matrix

.. include:: repeated-formulas/spiral-rotation-matrix-uvn.txt

Collinear local reference frame
===============================
Magnopy generates a collinear local reference frame by populating
the atomic lattice with spins all collinear to the cone axis
:math:`\boldsymbol{S^n_{mi}}=S_i\,\boldsymbol{\hat{n}}`.

Intra-cell spin generation
==========================
Magnopy lets each intra-cell atomic spins
:math:`\boldsymbol{S_i}=S_i\,\boldsymbol{\hat{S}_i}`
have an independent orientation, that is described by the angles
:math:`(\theta_i,\,\phi_i)` measured in the :math:`(\,u,\,v,\,n\,)` reference
frame.  The spin is then generated by applying the rotation matrix

.. include:: repeated-formulas/spin-rotation-matrix-uvn.txt

introduced in the section :ref:`user-guide_methods_spin-rotations`
to the local collinear spin vector

.. math::
   \boldsymbol{S_i} = \boldsymbol{R_i}\,\boldsymbol{S^n_i}

Full cone-state generation
==========================
The full spin rotation matrix corresponding to the atomic site
:math:`(m,\,i)` is

.. math::
  \boldsymbol{R_{mi}}(\boldsymbol{q})
  =
  \boldsymbol{R_m}\,\boldsymbol{R_i}

The single-:math:`\boldsymbol{q}` spin state is generated by rotating
the collinear reference frame atomic spins

.. include:: repeated-formulas/spin-from-ferro-any.txt

The spin :math:`\boldsymbol{S_{mi}}` coordinates become

.. include:: repeated-formulas/spin-uvn.txt


where

.. math::
  \phi_{mi}(q) = \boldsymbol{q}\cdot\boldsymbol{r_m} + \phi_i
               = \boldsymbol{q}\cdot\boldsymbol{r_{mi}} + \Delta\phi_i

Note that Magnopy absorves the intra-cell spiral contribution inside the
angle
:math:`\phi_i=\boldsymbol{q}\cdot\boldsymbol{r_i}+\Delta\,\phi_i`

.. dropdown:: Full expression of the rotation matrix  :math:`\text{ }\boldsymbol{R_{mi}}`

  We define the different matrix elements as follows

  .. math::
    \boldsymbol{R_{mi}}
    =
    \begin{pmatrix}
      R^{11} & R^{12} & R^{13} \\
      R^{21} & R^{22} & R^{23} \\
      R^{31} & R^{32} & R^{33} \\
    \end{pmatrix}

  Then those matrix elements are

  .. math::
    &R^{11}
    =
    \cos(\boldsymbol{q}\cdot\boldsymbol{r_m})\left[\cos\theta_i + \sin^2\phi_i(1-\cos\theta_i)\right]-\sin(\boldsymbol{q}\cdot\boldsymbol{r_m})\left[-\sin\phi_i\cos\phi_i(1-\cos\theta_i)\right]
    =\\&=
    (1-\cos\theta_i)\left[\cos(\boldsymbol{q}\cdot\boldsymbol{r_m})\sin^2\phi_i+\sin(\boldsymbol{q}\cdot\boldsymbol{r_m})\sin\phi_i\cos\phi_i\right]+\cos(\boldsymbol{q}\cdot\boldsymbol{r_m})\cos\theta_i
    =\\&=
    (1-\cos\theta_i)\sin\phi_i\sin(\boldsymbol{q}\cdot\boldsymbol{r_m}+\phi_i)+\cos(\boldsymbol{q}\cdot\boldsymbol{r_m})\cos\theta_i

  .. math::
    &R^{12}
    =
    \cos(\boldsymbol{q}\cdot\boldsymbol{r_m})\left[-\sin\phi_i\cos\phi_i(1-\cos\theta_i)\right]-\sin(\boldsymbol{q}\cdot\boldsymbol{r_m})\left[\cos\theta_i + \cos^2\phi_i(1-\cos\theta_i)\right]
    =\\&=
    (1-\cos\theta_i)\left[-\cos(\boldsymbol{q}\cdot\boldsymbol{r_m})\sin\phi_i\cos\phi_i-\sin(\boldsymbol{q}\cdot\boldsymbol{r_m})\cos^2\phi_i\right]-\sin(\boldsymbol{q}\cdot\boldsymbol{r_m})\cos\theta_i
    =\\&=
    -(1-\cos\theta_i)\cos\phi_i\sin(\boldsymbol{q}\cdot\boldsymbol{r_m}+\phi_i)-\sin(\boldsymbol{q}\cdot\boldsymbol{r_m})\cos\theta_i

  .. math::
    R^{13}
    =
    \sin\theta_i(\cos(\boldsymbol{q}\cdot\boldsymbol{r_m})\cos\phi_i - \sin(\boldsymbol{q}\cdot\boldsymbol{r_m})\sin\phi_i)
    =
    \sin\theta_i\cos(\boldsymbol{q}\cdot\boldsymbol{r_m} + \phi_i)

  .. math::
    &R^{21}
    =
    \sin(\boldsymbol{q}\cdot\boldsymbol{r_m})\left[\cos\theta_i + \sin^2\phi_i(1-\cos\theta_i)\right]+\cos(\boldsymbol{q}\cdot\boldsymbol{r_m})\left[-\sin\phi_i\cos\phi_i(1-\cos\theta_i)\right]
    =\\&=
    (1-\cos\theta_i)\left[\sin(\boldsymbol{q}\cdot\boldsymbol{r_m})\sin^2\phi_i-\cos(\boldsymbol{q}\cdot\boldsymbol{r_m})\sin\phi_i\cos\phi_i\right]+\sin(\boldsymbol{q}\cdot\boldsymbol{r_m})\cos\theta_i
    =\\&=
    -(1-\cos\theta_i)\sin\phi_i\cos(\boldsymbol{q}\cdot\boldsymbol{r_m}+\phi_i)+\sin(\boldsymbol{q}\cdot\boldsymbol{r_m})\cos\theta_i

  .. math::
    &R^{22}
    =
    \sin(\boldsymbol{q}\cdot\boldsymbol{r_m})\left[-\sin\phi_i\cos\phi_i(1-\cos\theta_i)\right]+\cos(\boldsymbol{q}\cdot\boldsymbol{r_m})\left[\cos\theta_i + \cos^2\phi_i(1-\cos\theta_i)\right]
    =\\&=
    (1-\cos\theta_i)\left[-\sin(\boldsymbol{q}\cdot\boldsymbol{r_m})\sin\phi_i\cos\phi_i+\cos(\boldsymbol{q}\cdot\boldsymbol{r_m})\cos^2\phi_i\right]+\cos(\boldsymbol{q}\cdot\boldsymbol{r_m})\cos\theta_i
    =\\&=
    (1-\cos\theta_i)\cos\phi_i\cos(\boldsymbol{q}\cdot\boldsymbol{r_m}+\phi_i)+\cos(\boldsymbol{q}\cdot\boldsymbol{r_m})\cos\theta_i

  .. math::
    R^{23}
    =
    \sin\theta_i(\sin(\boldsymbol{q}\cdot\boldsymbol{r_m})\cos\phi_i + \cos(\boldsymbol{q}\cdot\boldsymbol{r_m})\sin\phi_i)
    =
    \sin\theta_i\sin(\boldsymbol{q}\cdot\boldsymbol{r_m} + \phi_i)

  .. math::
    R^{31} = -\cos\phi_i\sin\theta_i

  .. math::
    R^{32} = -\sin\phi_i\sin\theta_i

  .. math::
    R^{33} = \cos\theta_i

.. _user-guide_methods_single-q_examples:

Examples
========

* One spin in the unit cell, :math:`\boldsymbol{q} = (0,0,1)^T`:

  - :math:`\boldsymbol{r}_1 = (0,0,0)`,
    :math:`\theta_1 = 90^{\circ}`,
    :math:`\phi_1 = 0^{\circ}`


.. raw:: html
  :file: ../../../images/single-q-1.html

* One spin in the unit cell, :math:`\boldsymbol{q} = (0,0,1)^T`:

  - :math:`\boldsymbol{r}_1 = (0,0,0)`,
    :math:`\theta_1 = 60^{\circ}`,
    :math:`\phi_1 = 0^{\circ}`


.. raw:: html
  :file: ../../../images/single-q-2.html

* One spin in the unit cell, :math:`\boldsymbol{q} = (0,0,1)^T`:

  - :math:`\boldsymbol{r}_1 = (0,0,0)`,
    :math:`\theta_1 = 60^{\circ}`,
    :math:`\phi_1 = 45^{\circ}`

.. raw:: html
  :file: ../../../images/single-q-3.html

* One spin in the unit cell, :math:`\boldsymbol{q} = (0,1,0)^T`:

  - :math:`\boldsymbol{r}_1 = (0,0,0)`,
    :math:`\theta_1 = 30^{\circ}`,
    :math:`\phi_1 = 0^{\circ}`

.. raw:: html
  :file: ../../../images/single-q-4.html

* Two spins in the unit cell, :math:`\boldsymbol{q} = (0,1,0)^T`:

  - :math:`\boldsymbol{r}_1 = (0,0,0)`,
    :math:`\theta_1 = 30^{\circ}`,
    :math:`\phi_1 = 0^{\circ}`
  - :math:`\boldsymbol{r}_2 = (\frac{1}{2},\frac{1}{2},\frac{1}{2})`,
    :math:`\theta_2 = 20^{\circ}`,
    :math:`\phi_2 = 45^{\circ}`


.. raw:: html
  :file: ../../../images/single-q-5.html

* Two spins in the unit cell, :math:`\boldsymbol{q} = (1,0,0)^T`:

  - :math:`\boldsymbol{r}_1 = (0,0,0)`,
    :math:`\theta_1 = 150^{\circ}`,
    :math:`\phi_1 = 0^{\circ}`
  - :math:`\boldsymbol{r}_2 = (0,\frac{1}{2},0)`,
    :math:`\theta_2 = 30^{\circ}`,
    :math:`\phi_2 =180^{\circ}`

.. raw:: html
  :file: ../../../images/single-q-6.html
